<?xml version="1.0" ?>
<launch>
      <param name="/use_sim_time" value="true" />

      <!--- muse amcl parameters -->
    <group ns="muse_mcl_2d">
        <param name="world_frame"     value="/world" />
        <param name="odom_frame"      value="/odom" />
        <param name="base_frame"      value="/base_link" />
        <param name="topic_poses"     value="/muse_mcl/poses"/>
        <param name="pub_rate_poses"  value="30.0" />
        <param name="pub_rate_tf"     value="60.0" />
        <param name="pub_rate_state"  value="10.0" />
        <param name="node_rate"       value="0.0" />
        
        <group ns="initialization">
            <!-- x y yaw -->
            <!-- [-1.37, -7.28, 1.4943509] -->
            <rosparam param="pose">
                [0, 0, 0]
            </rosparam>
            <!-- (x y phi)Â² -->
            <rosparam param="covariance">
                [0.25, 0.0, 0.0,
                 0.0, 0.25, 0.0,
                 0.0, 0.0, 0.06853891945200942]
            </rosparam>
        </group>
        <!--- HERE GO THE SENSOR MODELS! -->
        <group ns="front_laser">
            <param name="class"                    value="muse_mcl_2d_laser::LaserProvider2D" />
            <param name="base_class"               value="muse_mcl_2d::DataProvider2D" />
            <param name="topic"                    value="/sick/front" />
            <param name="undistortion"             value="true" />
            <param name="undistortion_fixed_frame" value="odom" />
            <param name="undistortion_tf_timeout"  value="0.1" />
            <param name="range_max"                value="10.0" />
            <param name="range_min"                value="0.1" />
            <param name="rate"                     value="0.0" />
            <!-- <param name="angle_min" value="-3.1425" /> -->
            <!-- <param name="angle_max" value="3.1425" /> -->
            <param name="queue_size"               value="10" />
        </group>
        <group ns="rear_laser">
          <param name="class"                    value="muse_mcl_2d_laser::LaserProvider2D" />
          <param name="base_class"               value="muse_mcl_2d::DataProvider2D" />
          <param name="topic"                    value="/sick/rear" />
          <param name="undistortion"             value="true" />
          <param name="undistortion_fixed_frame" value="/odom" />
          <param name="undistortion_tf_timeout"  value="0.1" />
          <param name="range_max"                value="30.0" />
          <param name="range_min"                value="0.1" />
          <param name="queue_size"               value="10" />
          <param name="rate"                     value="0.0" />
          <!-- <param name="angle_min" value="-3.1425" /> -->
          <!-- <param name="angle_max" value="3.1425" /> -->
        </group>
        <group ns="beam_model_front">
            <param name="class"         value="muse_mcl_2d_ndt::LikelihoodFieldModelAMCL" />
            <param name="base_class"    value="muse_mcl_2d::UpdateModel2D" />
            <param name="data_provider" value="front_laser" />
            <param name="map_provider"  value="rawseeds" />
            <param name="z_hit"         value="0.8"/>
            <param name="z_short"       value="0.05"/>
            <param name="z_max"         value="0.05"/>
            <param name="z_rand"        value="0.1"/>
            <param name="sigma_hit"     value="0.15"/>
            <param name="lambda_short"  value="0.1"/>
            <param name="max_beams"     value="30" />
            <param name="use_estimated_parameters" value="false" />
            <param name="use_weights_for_estimation" value="true" />
        </group>
        <group ns="beam_model_rear">
            <param name="class"         value="muse_mcl_2d_gridmaps::LikelihoodFieldModelAMCL" />
            <param name="base_class"    value="muse_mcl_2d::UpdateModel2D" />
            <param name="data_provider" value="rear_laser" />
            <param name="map_provider"  value="rawseeds" />
            <param name="z_hit"         value="0.8"/>
            <param name="z_short"       value="0.05"/>
            <param name="z_max"         value="0.05"/>
            <param name="z_rand"        value="0.1"/>
            <param name="sigma_hit"     value="0.15"/>
            <param name="lambda_short"  value="0.1"/>
            <param name="max_beams"     value="30" />
            <param name="use_estimated_parameters" value="false" />
            <param name="use_weights_for_estimation" value="true" />
        </group>
        <group ns="rawseeds">
          <param name="class"       value="muse_mcl_2d_ndt::LikelihoodFieldOccupancyGridmapProvider" />
          <param name="base_class"  value="muse_mcl_2d::MapProvider2D" />
          <param name="path"        value="/data/0/rawseeds/maps/without_stereo/Bicocca_2009-02-25a-dynamic-natural-light-groundtruth-cartographer/map/2d/occ_ndt/map" />
          <param name="blocking"    value="true" />
	  <param name="sampling_resolution" value="0.025" />
        </group>
        <!--- HERE GOES THE ODOMETRY MODEL! -->
        <group ns="differential_drive_model">
            <param name="class" value="muse_mcl_2d_odometry::DifferentialDrive" />
            <param name="base_class" value="muse_mcl_2d::PredictionModel2D"/>
            <param name="data_provider" value="odometry" />
            <param name="alpha1" value="0.05"/>
            <param name="alpha2" value="0.08"/>
            <param name="alpha3" value="0.2"/>
            <param name="alpha4" value="0.05"/>
            <param name="alpha5" value="0.0"/>
        </group>
        <group ns="odometry">
            <param name="class"      value="muse_mcl_2d_odometry::OdometryProvider2D" />
            <param name="base_class" value="muse_mcl_2d::DataProvider2D" />
            <param name="topic"      value="/odom" />
        </group>
        <!-- RE- AND SAMPLING -->
        <group ns="resampling">
            <param name="class"      value="muse_mcl_2d::KLD2D" />
            <param name="base_class" value="muse_mcl_2d::Resampling2D" />
        </group>
        <group ns="uniform_pose_generation">
          <rosparam param="maps">
            ["rawseeds"]
          </rosparam>
          <param name="class"       value="muse_mcl_2d::UniformAllMaps2D" />
          <param name="base_class"  value="muse_mcl_2d::UniformSampling2D" />
          <param name="seed"        value="2" />
          <param name="timeout"     value="10.0" />
          <param name="tf_timeout"  value="0.1" />
          <param name="sample_size" value="1000" />
        </group>
        <group ns="normal_pose_generation">
          <param name="class"       value="muse_mcl_2d::Normal2D" />
          <param name="base_class"  value="muse_mcl_2d::NormalSampling2D" />
          <rosparam param="maps">
            ["rawseeds"]
          </rosparam>
          <param name="timeout"     value="10.0" />
          <param name="tf_timeout"  value="0.1" />
          <param name="sample_size" value="1000" />
          <param name="seed"        value="0" />
        </group>

        <group ns="particle_filter">
            <param name="resampling_threshold_linear"  value="0.2" />
            <param name="resampling_threshold_angular" value="5.0" />
            <param name="resampling_cycle"             value="5" />
            <param name="integrate_all_measurement"    value="false" />

           <!-- <param name="sample_size"     value="" /> -->             <!-- if set, maximum and minimum are this value -->
            <param name="minimum_sample_size" value="50" />                   <!-- if not sample_size is already set -->
            <param name="maximum_sample_size" value="1000" />                   <!-- if not sample_size is already set -->
            
            <param name="resolution_linear" value="0.5" />  <!-- linear discretization resolution -->
            <param name="resolution_radial" value="20.0"/>  <!-- angular discretization resolution -->
        </group>
    </group>

  

    <!-- using only one map, the world and map frame can be collapsed -->
    <node pkg="tf" type="static_transform_publisher" name="map_T_w" args="0 0 0 0 0 0 map world 10"/>

    <arg name="map_path" value="/data/0/rawseeds/maps/without_stereo/Bicocca_2009-02-25a-dynamic-natural-light-groundtruth-cartographer/map/2d/occ_ndt/occ.map.raw.yaml" />    
    <!--<arg name="ndt_map_path" value="/data/0/rawseeds/maps/without_stereo/Bicocca_2009-02-25a-dynamic-natural-light-ext-groundtruth/map/2d/occ_ndt/map" />-->
    <arg name="bag_root" value="/data/0/rawseeds/bagfiles/without_stereo" />
    <arg name="bag_file" value="Bicocca_2009-02-25a-dynamic-natural-light-groundtruth-cartographer.bag" />
    <node pkg="map_server" type="map_server" name="map_server" output="screen" args="$(arg map_path)" />


    <include file="$(find rawseeds_ros)/launch/transforms_biccoca.launch" />
    <node pkg="rawseeds_ros" type="log_trajectory.py" name="log_trajectory" />
    <!-- <node type="record" name="robag_record" pkg="rosbag" args="-o /tmp/particles /muse_mcl/particles /muse_mcl/markers /tf" /> -->
    <!-- <node type="rviz" name="rviz" pkg="rviz" /> -->
    <!-- <node type="rqt_tf_tree" name="rqt_tf_tree" pkg="rqt_tf_tree" /> -->
    <node type="muse_mcl_2d_node" name="muse_mcl_2d" pkg="muse_mcl_2d" output="screen" />
</launch>
